{"version":3,"names":["_react","_interopRequireWildcard","require","_reactNativeReanimated","_hooks","e","t","WeakMap","r","n","__esModule","o","i","f","__proto__","default","has","get","set","hasOwnProperty","call","Object","defineProperty","getOwnPropertyDescriptor","_extends","assign","bind","arguments","length","apply","AnimatedMasonry","ensureMasonry","flashListModule","Animated","createAnimatedComponent","MasonryFlashList","console","error","MasonryFlashListMemo","React","memo","forwardRef","props","passRef","createElement","ref","Fragment","MasonryFlashListImpl","style","onContentSizeChange","contentContainerStyle","_contentContainerStyle","refreshControl","rest","name","useTabNameContext","setRef","contentInset","useTabsContext","recyclerRef","useSharedAnimatedRef","scrollHandler","enable","useScrollHandlerY","hadLoad","useSharedValue","onLoad","useCallback","value","useAnimatedReaction","ready","progressViewOffset","useCollapsibleStyle","useEffect","scrollContentSizeChange","useUpdateScrollViewContentSize","scrollContentSizeChangeHandlers","useChainCallback","useMemo","memoRefreshControl","cloneElement","memoContentInset","top","memoContentOffset","x","y","memoContentContainerStyle","paddingTop","refWorkaround","recyclerlistview_unsafe","bouncesZoom","onScroll","scrollEventThrottle","contentOffset","automaticallyAdjustContentInsets","exports"],"sources":["MasonryFlashList.tsx"],"sourcesContent":["import { MasonryFlashListProps, MasonryFlashListRef } from '@shopify/flash-list'\nimport React, { useCallback } from 'react'\nimport Animated, {\n  useAnimatedReaction,\n  useSharedValue,\n} from 'react-native-reanimated'\n\nimport {\n  useChainCallback,\n  useCollapsibleStyle,\n  useScrollHandlerY,\n  useSharedAnimatedRef,\n  useTabNameContext,\n  useTabsContext,\n  useUpdateScrollViewContentSize,\n} from './hooks'\n\n/**\n * Used as a memo to prevent rerendering too often when the context changes.\n * See: https://github.com/facebook/react/issues/15156#issuecomment-474590693\n */\n\ntype MasonryFlashListMemoProps = React.PropsWithChildren<\n  MasonryFlashListProps<unknown>\n>\ntype MasonryFlashListMemoRef = MasonryFlashListRef<any>\n\nlet AnimatedMasonry: React.ComponentClass<MasonryFlashListProps<any>> | null =\n  null\n\nconst ensureMasonry = () => {\n  if (AnimatedMasonry) {\n    return\n  }\n\n  try {\n    const flashListModule = require('@shopify/flash-list')\n    AnimatedMasonry = Animated.createAnimatedComponent(\n      flashListModule.MasonryFlashList\n    ) as unknown as React.ComponentClass<MasonryFlashListProps<any>>\n  } catch {\n    console.error(\n      'The optional dependency @shopify/flash-list is not installed. Please install it to use the FlashList component.'\n    )\n  }\n}\n\nconst MasonryFlashListMemo = React.memo(\n  React.forwardRef<MasonryFlashListMemoRef, MasonryFlashListMemoProps>(\n    (props, passRef) => {\n      ensureMasonry()\n      return AnimatedMasonry ? (\n        // @ts-expect-error\n        <AnimatedMasonry ref={passRef} {...props} />\n      ) : (\n        <></>\n      )\n    }\n  )\n)\n\nfunction MasonryFlashListImpl<R>(\n  {\n    style,\n    onContentSizeChange,\n    contentContainerStyle: _contentContainerStyle,\n    refreshControl,\n    ...rest\n  }: Omit<MasonryFlashListProps<R>, 'onScroll'>,\n  passRef: React.Ref<MasonryFlashListMemoRef>\n) {\n  const name = useTabNameContext()\n  const { setRef, contentInset } = useTabsContext()\n  const recyclerRef = useSharedAnimatedRef<any>(null)\n  const ref = useSharedAnimatedRef<any>(passRef)\n\n  const { scrollHandler, enable } = useScrollHandlerY(name)\n\n  const hadLoad = useSharedValue(false)\n\n  const onLoad = useCallback(() => {\n    hadLoad.value = true\n  }, [hadLoad])\n\n  useAnimatedReaction(\n    () => {\n      return hadLoad.value\n    },\n    (ready) => {\n      if (ready) {\n        enable(true)\n      }\n    }\n  )\n\n  const { progressViewOffset, contentContainerStyle } = useCollapsibleStyle()\n\n  React.useEffect(() => {\n    setRef(name, recyclerRef)\n  }, [name, recyclerRef, setRef])\n\n  const scrollContentSizeChange = useUpdateScrollViewContentSize({\n    name,\n  })\n\n  const scrollContentSizeChangeHandlers = useChainCallback(\n    React.useMemo(\n      () => [scrollContentSizeChange, onContentSizeChange],\n      [onContentSizeChange, scrollContentSizeChange]\n    )\n  )\n\n  const memoRefreshControl = React.useMemo(\n    () =>\n      refreshControl &&\n      React.cloneElement(refreshControl, {\n        progressViewOffset,\n        ...refreshControl.props,\n      }),\n    [progressViewOffset, refreshControl]\n  )\n\n  const memoContentInset = React.useMemo(\n    () => ({ top: contentInset }),\n    [contentInset]\n  )\n\n  const memoContentOffset = React.useMemo(\n    () => ({ x: 0, y: -contentInset }),\n    [contentInset]\n  )\n\n  const memoContentContainerStyle = React.useMemo(\n    () => ({\n      paddingTop: contentContainerStyle.paddingTop,\n      ..._contentContainerStyle,\n    }),\n    [_contentContainerStyle, contentContainerStyle.paddingTop]\n  )\n\n  const refWorkaround = useCallback(\n    (value: MasonryFlashListMemoRef | null): void => {\n      // https://github.com/Shopify/flash-list/blob/2d31530ed447a314ec5429754c7ce88dad8fd087/src/FlashList.tsx#L829\n      // We are not accessing the right element or view of the Flashlist (recyclerlistview). So we need to give\n      // this ref the access to it\n      // @ts-expect-error\n      ;(recyclerRef as any)(value?.recyclerlistview_unsafe)\n      ;(ref as any)(value)\n    },\n    [recyclerRef, ref]\n  )\n\n  return (\n    // @ts-expect-error typescript complains about `unknown` in the memo, it should be T\n    <MasonryFlashListMemo\n      {...rest}\n      onLoad={onLoad}\n      contentContainerStyle={memoContentContainerStyle}\n      ref={refWorkaround}\n      bouncesZoom={false}\n      onScroll={scrollHandler}\n      scrollEventThrottle={16}\n      contentInset={memoContentInset}\n      contentOffset={memoContentOffset}\n      refreshControl={memoRefreshControl}\n      progressViewOffset={progressViewOffset}\n      automaticallyAdjustContentInsets={false}\n      onContentSizeChange={scrollContentSizeChangeHandlers}\n    />\n  )\n}\n\n/**\n * Use like a regular MasonryFlashList.\n */\nexport const MasonryFlashList = React.forwardRef(MasonryFlashListImpl) as <T>(\n  p: MasonryFlashListProps<T> & { ref?: React.Ref<MasonryFlashListMemoRef> }\n) => React.ReactElement\n"],"mappings":"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","ignoreList":[]}