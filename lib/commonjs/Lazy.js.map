{"version":3,"names":["_react","_interopRequireWildcard","require","_reactNative","_reactNativeReanimated","_ScrollView","_hooks","e","t","WeakMap","r","n","__esModule","o","i","f","__proto__","default","has","get","set","hasOwnProperty","call","Object","defineProperty","getOwnPropertyDescriptor","Lazy","children","cancelLazyFadeIn","startMounted","_startMounted","mountDelayMs","name","useTabNameContext","focusedTab","refMap","useTabsContext","didTriggerLayout","useSharedValue","canMount","setCanMount","React","useState","isSelfMounted","useRef","shouldStartMounted","value","initialOpacity","opacity","useEffect","current","startMountTimer","useCallback","setTimeout","useAnimatedReaction","focused","wasFocused","runOnJS","scrollTo","useScroller","ref","isMounted","wasMounted","withTiming","stylez","useAnimatedStyle","onLayout","createElement","View","pointerEvents","style","styles","container","undefined","ScrollView","exports","StyleSheet","create","flex"],"sources":["Lazy.tsx"],"sourcesContent":["import React, { useCallback } from 'react'\nimport { StyleSheet } from 'react-native'\nimport Animated, {\n  useSharedValue,\n  useAnimatedReaction,\n  runOnJS,\n  withTiming,\n  useAnimatedStyle,\n} from 'react-native-reanimated'\n\nimport { ScrollView } from './ScrollView'\nimport { useScroller, useTabNameContext, useTabsContext } from './hooks'\n\n/**\n * Typically used internally, but if you want to mix lazy and regular screens you can wrap the lazy ones with this component.\n */\nexport const Lazy: React.FC<{\n  /**\n   * Whether to cancel the lazy fade in animation. Defaults to false.\n   */\n  cancelLazyFadeIn?: boolean\n  /**\n   * How long to wait before mounting the children.\n   */\n  mountDelayMs?: number\n  /**\n   * Whether to start mounted. Defaults to true if we are the focused tab.\n   */\n  startMounted?: boolean\n  children: React.ReactElement\n}> = ({\n  children,\n  cancelLazyFadeIn,\n  startMounted: _startMounted,\n  mountDelayMs = 50,\n}) => {\n  const name = useTabNameContext()\n  const { focusedTab, refMap } = useTabsContext()\n\n  /**\n   * We keep track of whether a layout has been triggered\n   */\n  const didTriggerLayout = useSharedValue(false)\n\n  /**\n   * This is used to control when children are mounted\n   */\n  const [canMount, setCanMount] = React.useState(false)\n  /**\n   * Ensure we don't mount after the component has been unmounted\n   */\n  const isSelfMounted = React.useRef(true)\n\n  /**\n   * We start mounted if we are the focused tab, or if props.startMounted is true.\n   */\n  const shouldStartMounted =\n    typeof _startMounted === 'boolean'\n      ? _startMounted\n      : focusedTab.value === name\n  let initialOpacity = 1\n  if (!cancelLazyFadeIn && !shouldStartMounted) {\n    initialOpacity = 0\n  }\n  const opacity = useSharedValue(initialOpacity)\n\n  React.useEffect(() => {\n    return () => {\n      isSelfMounted.current = false\n    }\n  }, [])\n\n  const startMountTimer = React.useCallback(\n    (focusedTab: string) => {\n      // wait the scene to be at least mountDelay ms focused, before mounting\n      setTimeout(() => {\n        if (focusedTab === name) {\n          if (isSelfMounted.current) setCanMount(true)\n        }\n      }, mountDelayMs)\n    },\n    [mountDelayMs, name]\n  )\n\n  useAnimatedReaction(\n    () => {\n      return focusedTab.value === name\n    },\n    (focused, wasFocused) => {\n      if (focused && !wasFocused && !canMount) {\n        if (cancelLazyFadeIn) {\n          opacity.value = 1\n          runOnJS(setCanMount)(true)\n        } else {\n          runOnJS(startMountTimer)(focusedTab.value)\n        }\n      }\n    },\n    [canMount, focusedTab]\n  )\n\n  const scrollTo = useScroller()\n\n  const ref = name ? refMap[name] : null\n\n  useAnimatedReaction(\n    () => {\n      return didTriggerLayout.value\n    },\n    (isMounted, wasMounted) => {\n      if (isMounted && !wasMounted) {\n        if (!cancelLazyFadeIn && opacity.value !== 1) {\n          opacity.value = withTiming(1)\n        }\n      }\n    },\n    [ref, cancelLazyFadeIn, name, didTriggerLayout, scrollTo]\n  )\n\n  const stylez = useAnimatedStyle(() => {\n    return {\n      opacity: opacity.value,\n    }\n  }, [opacity])\n\n  const onLayout = useCallback(() => {\n    didTriggerLayout.value = true\n  }, [didTriggerLayout])\n\n  return canMount ? (\n    cancelLazyFadeIn ? (\n      children\n    ) : (\n      <Animated.View\n        pointerEvents=\"box-none\"\n        style={[styles.container, !cancelLazyFadeIn ? stylez : undefined]}\n        onLayout={onLayout}\n      >\n        {children}\n      </Animated.View>\n    )\n  ) : (\n    <ScrollView />\n  )\n}\n\nconst styles = StyleSheet.create({\n  container: {\n    flex: 1,\n  },\n})\n"],"mappings":"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","ignoreList":[]}