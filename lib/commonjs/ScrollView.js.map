{"version":3,"names":["_react","_interopRequireDefault","require","_reactNativeReanimated","_hooks","e","__esModule","default","_extends","Object","assign","bind","n","arguments","length","t","r","hasOwnProperty","call","apply","ScrollViewMemo","React","memo","forwardRef","props","passRef","createElement","ScrollView","ref","exports","contentContainerStyle","style","onContentSizeChange","children","refreshControl","rest","name","useTabNameContext","useSharedAnimatedRef","setRef","contentInset","useTabsContext","_style","_contentContainerStyle","progressViewOffset","useCollapsibleStyle","scrollHandler","enable","useScrollHandlerY","onLayout","useAfterMountEffect","useEffect","scrollContentSizeChange","useUpdateScrollViewContentSize","scrollContentSizeChangeHandlers","useChainCallback","useMemo","memoRefreshControl","cloneElement","memoContentInset","top","memoContentOffset","x","y","memoContentContainerStyle","memoStyle","bouncesZoom","onScroll","scrollEventThrottle","contentOffset","automaticallyAdjustContentInsets","onMomentumScrollEnd"],"sources":["ScrollView.tsx"],"sourcesContent":["import React from 'react'\nimport { ScrollViewProps, ScrollView as RNScrollView } from 'react-native'\nimport Animated from 'react-native-reanimated'\n\nimport {\n  useAfterMountEffect,\n  useChainCallback,\n  useCollapsibleStyle,\n  useScrollHandlerY,\n  useSharedAnimatedRef,\n  useTabNameContext,\n  useTabsContext,\n  useUpdateScrollViewContentSize,\n} from './hooks'\n\n/**\n * Used as a memo to prevent rerendering too often when the context changes.\n * See: https://github.com/facebook/react/issues/15156#issuecomment-474590693\n */\nconst ScrollViewMemo = React.memo(\n  React.forwardRef<RNScrollView, React.PropsWithChildren<ScrollViewProps>>(\n    (props, passRef) => {\n      return (\n        <Animated.ScrollView\n          // @ts-expect-error reanimated types are broken on ref\n          ref={passRef}\n          {...props}\n        />\n      )\n    }\n  )\n)\n\n/**\n * Use like a regular ScrollView.\n */\nexport const ScrollView = React.forwardRef<\n  RNScrollView,\n  React.PropsWithChildren<Omit<ScrollViewProps, 'onScroll'>>\n>(\n  (\n    {\n      contentContainerStyle,\n      style,\n      onContentSizeChange,\n      children,\n      refreshControl,\n      ...rest\n    },\n    passRef\n  ) => {\n    const name = useTabNameContext()\n    const ref = useSharedAnimatedRef<RNScrollView>(passRef)\n    const { setRef, contentInset } = useTabsContext()\n    const {\n      style: _style,\n      contentContainerStyle: _contentContainerStyle,\n      progressViewOffset,\n    } = useCollapsibleStyle()\n    const { scrollHandler, enable } = useScrollHandlerY(name)\n    const onLayout = useAfterMountEffect(rest.onLayout, () => {\n      'worklet'\n      // we enable the scroll event after mounting\n      // otherwise we get an `onScroll` call with the initial scroll position which can break things\n      enable(true)\n    })\n\n    React.useEffect(() => {\n      setRef(name, ref)\n    }, [name, ref, setRef])\n\n    const scrollContentSizeChange = useUpdateScrollViewContentSize({\n      name,\n    })\n\n    const scrollContentSizeChangeHandlers = useChainCallback(\n      React.useMemo(\n        () => [scrollContentSizeChange, onContentSizeChange],\n        [onContentSizeChange, scrollContentSizeChange]\n      )\n    )\n\n    const memoRefreshControl = React.useMemo(\n      () =>\n        refreshControl &&\n        React.cloneElement(refreshControl, {\n          progressViewOffset,\n          ...refreshControl.props,\n        }),\n      [progressViewOffset, refreshControl]\n    )\n\n    const memoContentInset = React.useMemo(\n      () => ({ top: contentInset }),\n      [contentInset]\n    )\n\n    const memoContentOffset = React.useMemo(\n      () => ({ x: 0, y: -contentInset }),\n      [contentInset]\n    )\n\n    const memoContentContainerStyle = React.useMemo(\n      () => [\n        _contentContainerStyle,\n        // TODO: investigate types\n        contentContainerStyle as any,\n      ],\n      [_contentContainerStyle, contentContainerStyle]\n    )\n    const memoStyle = React.useMemo(() => [_style, style], [_style, style])\n\n    return (\n      <ScrollViewMemo\n        {...rest}\n        onLayout={onLayout}\n        ref={ref}\n        bouncesZoom={false}\n        style={memoStyle}\n        contentContainerStyle={memoContentContainerStyle}\n        onScroll={scrollHandler}\n        onContentSizeChange={scrollContentSizeChangeHandlers}\n        scrollEventThrottle={16}\n        contentInset={memoContentInset}\n        contentOffset={memoContentOffset}\n        automaticallyAdjustContentInsets={false}\n        refreshControl={memoRefreshControl}\n        // workaround for: https://github.com/software-mansion/react-native-reanimated/issues/2735\n        onMomentumScrollEnd={() => {}}\n      >\n        {children}\n      </ScrollViewMemo>\n    )\n  }\n)\n"],"mappings":"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","ignoreList":[]}