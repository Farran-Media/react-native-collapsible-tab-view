{"version":3,"names":["_react","_interopRequireWildcard","require","_reactNativeReanimated","_helpers","_hooks","e","t","WeakMap","r","n","__esModule","o","i","f","__proto__","default","has","get","set","hasOwnProperty","call","Object","defineProperty","getOwnPropertyDescriptor","_extends","assign","bind","arguments","length","apply","RawLegendList","ensureLegendList","legendListModule","LegendList","console","error","LegendListMemo","React","memo","forwardRef","props","passRef","createElement","ref","Fragment","LegendListImpl","contentContainerStyle","style","onContentSizeChange","refreshControl","rest","name","useTabNameContext","setRef","headerHeight","tabBarHeight","containerHeight","width","minHeaderHeight","focusedTab","tabNames","scrollYCurrent","scrollY","oldAccScrollY","accScrollY","offset","contentHeights","accDiffClamp","headerScrollDistance","revealHeaderOnScroll","allowHeaderOverscroll","useTabsContext","scrollViewRef","useAnimatedRef","enable","useScrollHandlerY","onLayout","useAfterMountEffect","containerHeightWithMinHeader","Math","max","_contentContainerStyle","useMemo","minHeight","paddingTop","progressViewOffset","IS_IOS","useEffect","scrollContentSizeChange","useUpdateScrollViewContentSize","scrollContentSizeChangeHandlers","useChainCallback","memoRefreshControl","cloneElement","memoContentContainerStyle","memoStyle","onScroll","useCallback","event","rawY","nativeEvent","contentOffset","y","runOnUI","_name","_containerHeight","_allowHeaderOverscroll","_revealHeaderOnScroll","value","contentHeight","indexOf","Number","MAX_VALUE","clampMax","interpolate","Extrapolation","CLAMP","delta","nextValue","min","refScrollView","bouncesZoom","scrollEventThrottle","automaticallyAdjustContentInsets","onMomentumScrollEnd","exports"],"sources":["LegendList.tsx"],"sourcesContent":["import type { LegendListProps as LLProps } from '@legendapp/list'\nimport React, { useCallback, useMemo } from 'react'\nimport { NativeScrollEvent, NativeSyntheticEvent } from 'react-native'\nimport {\n  Extrapolation,\n  interpolate,\n  runOnUI,\n  useAnimatedRef,\n} from 'react-native-reanimated'\n\nimport { IS_IOS } from './helpers'\nimport {\n  useAfterMountEffect,\n  useChainCallback,\n  useScrollHandlerY,\n  useTabNameContext,\n  useTabsContext,\n  useUpdateScrollViewContentSize,\n} from './hooks'\n\nlet RawLegendList: React.ComponentType<any> | null = null\n\nconst ensureLegendList = () => {\n  if (RawLegendList) return\n  try {\n    const legendListModule = require('@legendapp/list')\n    RawLegendList = legendListModule.LegendList\n  } catch {\n    console.error(\n      'The optional dependency @legendapp/list is not installed. Please install it to use the LegendList component.'\n    )\n  }\n}\n\n/**\n * Used as a memo to prevent rerendering too often when the context changes.\n * See: https://github.com/facebook/react/issues/15156#issuecomment-474590693\n */\nconst LegendListMemo = React.memo(\n  React.forwardRef<any, React.PropsWithChildren<any>>((props, passRef) => {\n    ensureLegendList()\n    return RawLegendList ? (\n      <RawLegendList ref={passRef} {...props} />\n    ) : (\n      <></>\n    )\n  })\n)\n\nfunction LegendListImpl<R>(\n  {\n    contentContainerStyle,\n    style,\n    onContentSizeChange,\n    refreshControl,\n    ...rest\n  }: Omit<LLProps<R>, 'onScroll'>,\n  passRef: React.Ref<any>\n): React.ReactElement {\n  const name = useTabNameContext()\n  const {\n    setRef,\n    headerHeight,\n    tabBarHeight,\n    containerHeight,\n    width,\n    minHeaderHeight,\n    focusedTab,\n    tabNames,\n    scrollYCurrent,\n    scrollY,\n    oldAccScrollY,\n    accScrollY,\n    offset,\n    contentHeights,\n    accDiffClamp,\n    headerScrollDistance,\n    revealHeaderOnScroll,\n    allowHeaderOverscroll,\n  } = useTabsContext()\n\n  // AnimatedRef to LegendList's internal ScrollView (via refScrollView prop)\n  // so scrollToImpl can sync scroll positions across tabs\n  const scrollViewRef = useAnimatedRef<any>()\n\n  // useScrollHandlerY for its sync-unfocused-scenes reaction and enable callback.\n  // We don't use its scrollHandler since LegendList has its own internal ScrollView.\n  const { enable } = useScrollHandlerY(name)\n\n  const onLayout = useAfterMountEffect(rest.onLayout, () => {\n    'worklet'\n    enable(true)\n  })\n\n  // LegendList doesn't support iOS contentInset, so we ALWAYS use paddingTop\n  // to position content below the header, regardless of allowHeaderOverscroll.\n  const containerHeightWithMinHeader = Math.max(\n    0,\n    (containerHeight ?? 0) - minHeaderHeight\n  )\n  const _contentContainerStyle = useMemo(\n    () => ({\n      minHeight: containerHeightWithMinHeader + (headerHeight || 0),\n      paddingTop: (headerHeight || 0) + (tabBarHeight || 0),\n    }),\n    [containerHeightWithMinHeader, headerHeight, tabBarHeight]\n  )\n  const progressViewOffset =\n    IS_IOS && allowHeaderOverscroll\n      ? 0\n      : (headerHeight || 0) + (tabBarHeight || 0)\n\n  // Register the internal ScrollView ref (not the LegendList ref) in the refMap\n  React.useEffect(() => {\n    setRef(name, scrollViewRef)\n  }, [name, scrollViewRef, setRef])\n\n  const scrollContentSizeChange = useUpdateScrollViewContentSize({ name })\n  const scrollContentSizeChangeHandlers = useChainCallback(\n    useMemo(\n      () => [scrollContentSizeChange, onContentSizeChange],\n      [onContentSizeChange, scrollContentSizeChange]\n    )\n  )\n\n  const memoRefreshControl = useMemo(\n    () =>\n      refreshControl &&\n      React.cloneElement(refreshControl, {\n        progressViewOffset,\n        ...refreshControl.props,\n      }),\n    [progressViewOffset, refreshControl]\n  )\n\n  const memoContentContainerStyle = useMemo(\n    () => ({\n      ..._contentContainerStyle,\n      ...(contentContainerStyle as object),\n    }),\n    [_contentContainerStyle, contentContainerStyle]\n  )\n\n  const memoStyle = useMemo(\n    () => [{ width }, style],\n    [width, style]\n  )\n\n  // JS-level scroll handler â€” updates shared values via runOnUI.\n  // No contentInset adjustment needed since LegendList uses paddingTop instead.\n  const onScroll = useCallback(\n    (event: NativeSyntheticEvent<NativeScrollEvent>) => {\n      const rawY = event.nativeEvent.contentOffset.y\n      runOnUI(\n        (\n          y: number,\n          _name: string,\n          _containerHeight: number,\n          _allowHeaderOverscroll: boolean | undefined,\n          _revealHeaderOnScroll: boolean\n        ) => {\n          'worklet'\n          if (focusedTab.value !== _name) return\n\n          if (IS_IOS) {\n            const contentHeight =\n              contentHeights.value[tabNames.value.indexOf(_name)] ||\n              Number.MAX_VALUE\n            const clampMax = contentHeight - (_containerHeight || 0)\n            scrollYCurrent.value = _allowHeaderOverscroll\n              ? y\n              : interpolate(\n                  y,\n                  [0, clampMax],\n                  [0, clampMax],\n                  Extrapolation.CLAMP\n                )\n          } else {\n            scrollYCurrent.value = y\n          }\n\n          scrollY.value[_name] = scrollYCurrent.value\n          oldAccScrollY.value = accScrollY.value\n          accScrollY.value = scrollY.value[_name] + offset.value\n\n          if (_revealHeaderOnScroll) {\n            const delta = accScrollY.value - oldAccScrollY.value\n            const nextValue = accDiffClamp.value + delta\n            if (delta > 0) {\n              accDiffClamp.value = Math.min(\n                headerScrollDistance.value,\n                nextValue\n              )\n            } else if (delta < 0) {\n              accDiffClamp.value = Math.max(0, nextValue)\n            }\n          }\n        }\n      )(rawY, name, containerHeight, allowHeaderOverscroll, revealHeaderOnScroll)\n    },\n    [\n      name,\n      focusedTab,\n      contentHeights,\n      tabNames,\n      containerHeight,\n      scrollYCurrent,\n      scrollY,\n      oldAccScrollY,\n      accScrollY,\n      offset,\n      allowHeaderOverscroll,\n      revealHeaderOnScroll,\n      accDiffClamp,\n      headerScrollDistance,\n    ]\n  )\n\n  return (\n    <LegendListMemo\n      {...rest}\n      onLayout={onLayout}\n      ref={passRef}\n      refScrollView={scrollViewRef}\n      bouncesZoom={false}\n      style={memoStyle}\n      contentContainerStyle={memoContentContainerStyle}\n      progressViewOffset={progressViewOffset}\n      onScroll={onScroll}\n      onContentSizeChange={scrollContentSizeChangeHandlers}\n      scrollEventThrottle={16}\n      automaticallyAdjustContentInsets={false}\n      refreshControl={memoRefreshControl}\n      onMomentumScrollEnd={() => {}}\n    />\n  )\n}\n\n/**\n * Use like a regular LegendList from @legendapp/list.\n */\nexport const LegendList = React.forwardRef(LegendListImpl) as <T>(\n  p: Omit<LLProps<T>, 'onScroll'> & { ref?: React.Ref<any> }\n) => React.ReactElement\n"],"mappings":"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","ignoreList":[]}