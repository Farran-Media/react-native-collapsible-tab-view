{"version":3,"names":["React","useCallback","useMemo","Extrapolation","interpolate","runOnUI","useAnimatedRef","IS_IOS","useAfterMountEffect","useChainCallback","useScrollHandlerY","useTabNameContext","useTabsContext","useUpdateScrollViewContentSize","RawLegendList","ensureLegendList","legendListModule","require","LegendList","console","error","LegendListMemo","memo","forwardRef","props","passRef","createElement","_extends","ref","Fragment","LegendListImpl","contentContainerStyle","style","onContentSizeChange","refreshControl","rest","name","setRef","headerHeight","tabBarHeight","containerHeight","width","minHeaderHeight","focusedTab","tabNames","scrollYCurrent","scrollY","oldAccScrollY","accScrollY","offset","contentHeights","accDiffClamp","headerScrollDistance","revealHeaderOnScroll","allowHeaderOverscroll","scrollViewRef","enable","onLayout","containerHeightWithMinHeader","Math","max","_contentContainerStyle","minHeight","paddingTop","progressViewOffset","useEffect","scrollContentSizeChange","scrollContentSizeChangeHandlers","memoRefreshControl","cloneElement","memoContentContainerStyle","memoStyle","onScroll","event","rawY","nativeEvent","contentOffset","y","_name","_containerHeight","_allowHeaderOverscroll","_revealHeaderOnScroll","value","contentHeight","indexOf","Number","MAX_VALUE","clampMax","CLAMP","delta","nextValue","min","refScrollView","bouncesZoom","scrollEventThrottle","automaticallyAdjustContentInsets","onMomentumScrollEnd"],"sources":["LegendList.tsx"],"sourcesContent":["import type { LegendListProps as LLProps } from '@legendapp/list'\nimport React, { useCallback, useMemo } from 'react'\nimport { NativeScrollEvent, NativeSyntheticEvent } from 'react-native'\nimport {\n  Extrapolation,\n  interpolate,\n  runOnUI,\n  useAnimatedRef,\n} from 'react-native-reanimated'\n\nimport { IS_IOS } from './helpers'\nimport {\n  useAfterMountEffect,\n  useChainCallback,\n  useScrollHandlerY,\n  useTabNameContext,\n  useTabsContext,\n  useUpdateScrollViewContentSize,\n} from './hooks'\n\nlet RawLegendList: React.ComponentType<any> | null = null\n\nconst ensureLegendList = () => {\n  if (RawLegendList) return\n  try {\n    const legendListModule = require('@legendapp/list')\n    RawLegendList = legendListModule.LegendList\n  } catch {\n    console.error(\n      'The optional dependency @legendapp/list is not installed. Please install it to use the LegendList component.'\n    )\n  }\n}\n\n/**\n * Used as a memo to prevent rerendering too often when the context changes.\n * See: https://github.com/facebook/react/issues/15156#issuecomment-474590693\n */\nconst LegendListMemo = React.memo(\n  React.forwardRef<any, React.PropsWithChildren<any>>((props, passRef) => {\n    ensureLegendList()\n    return RawLegendList ? (\n      <RawLegendList ref={passRef} {...props} />\n    ) : (\n      <></>\n    )\n  })\n)\n\nfunction LegendListImpl<R>(\n  {\n    contentContainerStyle,\n    style,\n    onContentSizeChange,\n    refreshControl,\n    ...rest\n  }: Omit<LLProps<R>, 'onScroll'>,\n  passRef: React.Ref<any>\n): React.ReactElement {\n  const name = useTabNameContext()\n  const {\n    setRef,\n    headerHeight,\n    tabBarHeight,\n    containerHeight,\n    width,\n    minHeaderHeight,\n    focusedTab,\n    tabNames,\n    scrollYCurrent,\n    scrollY,\n    oldAccScrollY,\n    accScrollY,\n    offset,\n    contentHeights,\n    accDiffClamp,\n    headerScrollDistance,\n    revealHeaderOnScroll,\n    allowHeaderOverscroll,\n  } = useTabsContext()\n\n  // AnimatedRef to LegendList's internal ScrollView (via refScrollView prop)\n  // so scrollToImpl can sync scroll positions across tabs\n  const scrollViewRef = useAnimatedRef<any>()\n\n  // useScrollHandlerY for its sync-unfocused-scenes reaction and enable callback.\n  // We don't use its scrollHandler since LegendList has its own internal ScrollView.\n  const { enable } = useScrollHandlerY(name)\n\n  const onLayout = useAfterMountEffect(rest.onLayout, () => {\n    'worklet'\n    enable(true)\n  })\n\n  // LegendList doesn't support iOS contentInset, so we ALWAYS use paddingTop\n  // to position content below the header, regardless of allowHeaderOverscroll.\n  const containerHeightWithMinHeader = Math.max(\n    0,\n    (containerHeight ?? 0) - minHeaderHeight\n  )\n  const _contentContainerStyle = useMemo(\n    () => ({\n      minHeight: containerHeightWithMinHeader + (headerHeight || 0),\n      paddingTop: (headerHeight || 0) + (tabBarHeight || 0),\n    }),\n    [containerHeightWithMinHeader, headerHeight, tabBarHeight]\n  )\n  const progressViewOffset =\n    IS_IOS && allowHeaderOverscroll\n      ? 0\n      : (headerHeight || 0) + (tabBarHeight || 0)\n\n  // Register the internal ScrollView ref (not the LegendList ref) in the refMap\n  React.useEffect(() => {\n    setRef(name, scrollViewRef)\n  }, [name, scrollViewRef, setRef])\n\n  const scrollContentSizeChange = useUpdateScrollViewContentSize({ name })\n  const scrollContentSizeChangeHandlers = useChainCallback(\n    useMemo(\n      () => [scrollContentSizeChange, onContentSizeChange],\n      [onContentSizeChange, scrollContentSizeChange]\n    )\n  )\n\n  const memoRefreshControl = useMemo(\n    () =>\n      refreshControl &&\n      React.cloneElement(refreshControl, {\n        progressViewOffset,\n        ...refreshControl.props,\n      }),\n    [progressViewOffset, refreshControl]\n  )\n\n  const memoContentContainerStyle = useMemo(\n    () => ({\n      ..._contentContainerStyle,\n      ...(contentContainerStyle as object),\n    }),\n    [_contentContainerStyle, contentContainerStyle]\n  )\n\n  const memoStyle = useMemo(\n    () => [{ width }, style],\n    [width, style]\n  )\n\n  // JS-level scroll handler â€” updates shared values via runOnUI.\n  // No contentInset adjustment needed since LegendList uses paddingTop instead.\n  const onScroll = useCallback(\n    (event: NativeSyntheticEvent<NativeScrollEvent>) => {\n      const rawY = event.nativeEvent.contentOffset.y\n      runOnUI(\n        (\n          y: number,\n          _name: string,\n          _containerHeight: number,\n          _allowHeaderOverscroll: boolean | undefined,\n          _revealHeaderOnScroll: boolean\n        ) => {\n          'worklet'\n          if (focusedTab.value !== _name) return\n\n          if (IS_IOS) {\n            const contentHeight =\n              contentHeights.value[tabNames.value.indexOf(_name)] ||\n              Number.MAX_VALUE\n            const clampMax = contentHeight - (_containerHeight || 0)\n            scrollYCurrent.value = _allowHeaderOverscroll\n              ? y\n              : interpolate(\n                  y,\n                  [0, clampMax],\n                  [0, clampMax],\n                  Extrapolation.CLAMP\n                )\n          } else {\n            scrollYCurrent.value = y\n          }\n\n          scrollY.value[_name] = scrollYCurrent.value\n          oldAccScrollY.value = accScrollY.value\n          accScrollY.value = scrollY.value[_name] + offset.value\n\n          if (_revealHeaderOnScroll) {\n            const delta = accScrollY.value - oldAccScrollY.value\n            const nextValue = accDiffClamp.value + delta\n            if (delta > 0) {\n              accDiffClamp.value = Math.min(\n                headerScrollDistance.value,\n                nextValue\n              )\n            } else if (delta < 0) {\n              accDiffClamp.value = Math.max(0, nextValue)\n            }\n          }\n        }\n      )(rawY, name, containerHeight, allowHeaderOverscroll, revealHeaderOnScroll)\n    },\n    [\n      name,\n      focusedTab,\n      contentHeights,\n      tabNames,\n      containerHeight,\n      scrollYCurrent,\n      scrollY,\n      oldAccScrollY,\n      accScrollY,\n      offset,\n      allowHeaderOverscroll,\n      revealHeaderOnScroll,\n      accDiffClamp,\n      headerScrollDistance,\n    ]\n  )\n\n  return (\n    <LegendListMemo\n      {...rest}\n      onLayout={onLayout}\n      ref={passRef}\n      refScrollView={scrollViewRef}\n      bouncesZoom={false}\n      style={memoStyle}\n      contentContainerStyle={memoContentContainerStyle}\n      progressViewOffset={progressViewOffset}\n      onScroll={onScroll}\n      onContentSizeChange={scrollContentSizeChangeHandlers}\n      scrollEventThrottle={16}\n      automaticallyAdjustContentInsets={false}\n      refreshControl={memoRefreshControl}\n      onMomentumScrollEnd={() => {}}\n    />\n  )\n}\n\n/**\n * Use like a regular LegendList from @legendapp/list.\n */\nexport const LegendList = React.forwardRef(LegendListImpl) as <T>(\n  p: Omit<LLProps<T>, 'onScroll'> & { ref?: React.Ref<any> }\n) => React.ReactElement\n"],"mappings":";AACA,OAAOA,KAAK,IAAIC,WAAW,EAAEC,OAAO,QAAQ,OAAO;AAEnD,SACEC,aAAa,EACbC,WAAW,EACXC,OAAO,EACPC,cAAc,QACT,yBAAyB;AAEhC,SAASC,MAAM,QAAQ,WAAW;AAClC,SACEC,mBAAmB,EACnBC,gBAAgB,EAChBC,iBAAiB,EACjBC,iBAAiB,EACjBC,cAAc,EACdC,8BAA8B,QACzB,SAAS;AAEhB,IAAIC,aAA8C,GAAG,IAAI;AAEzD,MAAMC,gBAAgB,GAAGA,CAAA,KAAM;EAC7B,IAAID,aAAa,EAAE;EACnB,IAAI;IACF,MAAME,gBAAgB,GAAGC,OAAO,CAAC,iBAAiB,CAAC;IACnDH,aAAa,GAAGE,gBAAgB,CAACE,UAAU;EAC7C,CAAC,CAAC,MAAM;IACNC,OAAO,CAACC,KAAK,CACX,8GACF,CAAC;EACH;AACF,CAAC;;AAED;AACA;AACA;AACA;AACA,MAAMC,cAAc,gBAAGrB,KAAK,CAACsB,IAAI,cAC/BtB,KAAK,CAACuB,UAAU,CAAoC,CAACC,KAAK,EAAEC,OAAO,KAAK;EACtEV,gBAAgB,CAAC,CAAC;EAClB,OAAOD,aAAa,gBAClBd,KAAA,CAAA0B,aAAA,CAACZ,aAAa,EAAAa,QAAA;IAACC,GAAG,EAAEH;EAAQ,GAAKD,KAAK,CAAG,CAAC,gBAE1CxB,KAAA,CAAA0B,aAAA,CAAA1B,KAAA,CAAA6B,QAAA,MAAI,CACL;AACH,CAAC,CACH,CAAC;AAED,SAASC,cAAcA,CACrB;EACEC,qBAAqB;EACrBC,KAAK;EACLC,mBAAmB;EACnBC,cAAc;EACd,GAAGC;AACyB,CAAC,EAC/BV,OAAuB,EACH;EACpB,MAAMW,IAAI,GAAGzB,iBAAiB,CAAC,CAAC;EAChC,MAAM;IACJ0B,MAAM;IACNC,YAAY;IACZC,YAAY;IACZC,eAAe;IACfC,KAAK;IACLC,eAAe;IACfC,UAAU;IACVC,QAAQ;IACRC,cAAc;IACdC,OAAO;IACPC,aAAa;IACbC,UAAU;IACVC,MAAM;IACNC,cAAc;IACdC,YAAY;IACZC,oBAAoB;IACpBC,oBAAoB;IACpBC;EACF,CAAC,GAAG1C,cAAc,CAAC,CAAC;;EAEpB;EACA;EACA,MAAM2C,aAAa,GAAGjD,cAAc,CAAM,CAAC;;EAE3C;EACA;EACA,MAAM;IAAEkD;EAAO,CAAC,GAAG9C,iBAAiB,CAAC0B,IAAI,CAAC;EAE1C,MAAMqB,QAAQ,GAAGjD,mBAAmB,CAAC2B,IAAI,CAACsB,QAAQ,EAAE,MAAM;IACxD,SAAS;;IACTD,MAAM,CAAC,IAAI,CAAC;EACd,CAAC,CAAC;;EAEF;EACA;EACA,MAAME,4BAA4B,GAAGC,IAAI,CAACC,GAAG,CAC3C,CAAC,EACD,CAACpB,eAAe,aAAfA,eAAe,cAAfA,eAAe,GAAI,CAAC,IAAIE,eAC3B,CAAC;EACD,MAAMmB,sBAAsB,GAAG3D,OAAO,CACpC,OAAO;IACL4D,SAAS,EAAEJ,4BAA4B,IAAIpB,YAAY,IAAI,CAAC,CAAC;IAC7DyB,UAAU,EAAE,CAACzB,YAAY,IAAI,CAAC,KAAKC,YAAY,IAAI,CAAC;EACtD,CAAC,CAAC,EACF,CAACmB,4BAA4B,EAAEpB,YAAY,EAAEC,YAAY,CAC3D,CAAC;EACD,MAAMyB,kBAAkB,GACtBzD,MAAM,IAAI+C,qBAAqB,GAC3B,CAAC,GACD,CAAChB,YAAY,IAAI,CAAC,KAAKC,YAAY,IAAI,CAAC,CAAC;;EAE/C;EACAvC,KAAK,CAACiE,SAAS,CAAC,MAAM;IACpB5B,MAAM,CAACD,IAAI,EAAEmB,aAAa,CAAC;EAC7B,CAAC,EAAE,CAACnB,IAAI,EAAEmB,aAAa,EAAElB,MAAM,CAAC,CAAC;EAEjC,MAAM6B,uBAAuB,GAAGrD,8BAA8B,CAAC;IAAEuB;EAAK,CAAC,CAAC;EACxE,MAAM+B,+BAA+B,GAAG1D,gBAAgB,CACtDP,OAAO,CACL,MAAM,CAACgE,uBAAuB,EAAEjC,mBAAmB,CAAC,EACpD,CAACA,mBAAmB,EAAEiC,uBAAuB,CAC/C,CACF,CAAC;EAED,MAAME,kBAAkB,GAAGlE,OAAO,CAChC,MACEgC,cAAc,iBACdlC,KAAK,CAACqE,YAAY,CAACnC,cAAc,EAAE;IACjC8B,kBAAkB;IAClB,GAAG9B,cAAc,CAACV;EACpB,CAAC,CAAC,EACJ,CAACwC,kBAAkB,EAAE9B,cAAc,CACrC,CAAC;EAED,MAAMoC,yBAAyB,GAAGpE,OAAO,CACvC,OAAO;IACL,GAAG2D,sBAAsB;IACzB,GAAI9B;EACN,CAAC,CAAC,EACF,CAAC8B,sBAAsB,EAAE9B,qBAAqB,CAChD,CAAC;EAED,MAAMwC,SAAS,GAAGrE,OAAO,CACvB,MAAM,CAAC;IAAEuC;EAAM,CAAC,EAAET,KAAK,CAAC,EACxB,CAACS,KAAK,EAAET,KAAK,CACf,CAAC;;EAED;EACA;EACA,MAAMwC,QAAQ,GAAGvE,WAAW,CACzBwE,KAA8C,IAAK;IAClD,MAAMC,IAAI,GAAGD,KAAK,CAACE,WAAW,CAACC,aAAa,CAACC,CAAC;IAC9CxE,OAAO,CACL,CACEwE,CAAS,EACTC,KAAa,EACbC,gBAAwB,EACxBC,sBAA2C,EAC3CC,qBAA8B,KAC3B;MACH,SAAS;;MACT,IAAItC,UAAU,CAACuC,KAAK,KAAKJ,KAAK,EAAE;MAEhC,IAAIvE,MAAM,EAAE;QACV,MAAM4E,aAAa,GACjBjC,cAAc,CAACgC,KAAK,CAACtC,QAAQ,CAACsC,KAAK,CAACE,OAAO,CAACN,KAAK,CAAC,CAAC,IACnDO,MAAM,CAACC,SAAS;QAClB,MAAMC,QAAQ,GAAGJ,aAAa,IAAIJ,gBAAgB,IAAI,CAAC,CAAC;QACxDlC,cAAc,CAACqC,KAAK,GAAGF,sBAAsB,GACzCH,CAAC,GACDzE,WAAW,CACTyE,CAAC,EACD,CAAC,CAAC,EAAEU,QAAQ,CAAC,EACb,CAAC,CAAC,EAAEA,QAAQ,CAAC,EACbpF,aAAa,CAACqF,KAChB,CAAC;MACP,CAAC,MAAM;QACL3C,cAAc,CAACqC,KAAK,GAAGL,CAAC;MAC1B;MAEA/B,OAAO,CAACoC,KAAK,CAACJ,KAAK,CAAC,GAAGjC,cAAc,CAACqC,KAAK;MAC3CnC,aAAa,CAACmC,KAAK,GAAGlC,UAAU,CAACkC,KAAK;MACtClC,UAAU,CAACkC,KAAK,GAAGpC,OAAO,CAACoC,KAAK,CAACJ,KAAK,CAAC,GAAG7B,MAAM,CAACiC,KAAK;MAEtD,IAAID,qBAAqB,EAAE;QACzB,MAAMQ,KAAK,GAAGzC,UAAU,CAACkC,KAAK,GAAGnC,aAAa,CAACmC,KAAK;QACpD,MAAMQ,SAAS,GAAGvC,YAAY,CAAC+B,KAAK,GAAGO,KAAK;QAC5C,IAAIA,KAAK,GAAG,CAAC,EAAE;UACbtC,YAAY,CAAC+B,KAAK,GAAGvB,IAAI,CAACgC,GAAG,CAC3BvC,oBAAoB,CAAC8B,KAAK,EAC1BQ,SACF,CAAC;QACH,CAAC,MAAM,IAAID,KAAK,GAAG,CAAC,EAAE;UACpBtC,YAAY,CAAC+B,KAAK,GAAGvB,IAAI,CAACC,GAAG,CAAC,CAAC,EAAE8B,SAAS,CAAC;QAC7C;MACF;IACF,CACF,CAAC,CAAChB,IAAI,EAAEtC,IAAI,EAAEI,eAAe,EAAEc,qBAAqB,EAAED,oBAAoB,CAAC;EAC7E,CAAC,EACD,CACEjB,IAAI,EACJO,UAAU,EACVO,cAAc,EACdN,QAAQ,EACRJ,eAAe,EACfK,cAAc,EACdC,OAAO,EACPC,aAAa,EACbC,UAAU,EACVC,MAAM,EACNK,qBAAqB,EACrBD,oBAAoB,EACpBF,YAAY,EACZC,oBAAoB,CAExB,CAAC;EAED,oBACEpD,KAAA,CAAA0B,aAAA,CAACL,cAAc,EAAAM,QAAA,KACTQ,IAAI;IACRsB,QAAQ,EAAEA,QAAS;IACnB7B,GAAG,EAAEH,OAAQ;IACbmE,aAAa,EAAErC,aAAc;IAC7BsC,WAAW,EAAE,KAAM;IACnB7D,KAAK,EAAEuC,SAAU;IACjBxC,qBAAqB,EAAEuC,yBAA0B;IACjDN,kBAAkB,EAAEA,kBAAmB;IACvCQ,QAAQ,EAAEA,QAAS;IACnBvC,mBAAmB,EAAEkC,+BAAgC;IACrD2B,mBAAmB,EAAE,EAAG;IACxBC,gCAAgC,EAAE,KAAM;IACxC7D,cAAc,EAAEkC,kBAAmB;IACnC4B,mBAAmB,EAAEA,CAAA,KAAM,CAAC;EAAE,EAC/B,CAAC;AAEN;;AAEA;AACA;AACA;AACA,OAAO,MAAM9E,UAAU,gBAAGlB,KAAK,CAACuB,UAAU,CAACO,cAAc,CAElC","ignoreList":[]}