{"version":3,"names":["React","Animated","useAfterMountEffect","useChainCallback","useCollapsibleStyle","useScrollHandlerY","useSharedAnimatedRef","useTabNameContext","useTabsContext","useUpdateScrollViewContentSize","ScrollViewMemo","memo","forwardRef","props","passRef","createElement","ScrollView","_extends","ref","contentContainerStyle","style","onContentSizeChange","children","refreshControl","rest","name","setRef","contentInset","_style","_contentContainerStyle","progressViewOffset","scrollHandler","enable","onLayout","useEffect","scrollContentSizeChange","scrollContentSizeChangeHandlers","useMemo","memoRefreshControl","cloneElement","memoContentInset","top","memoContentOffset","x","y","memoContentContainerStyle","memoStyle","bouncesZoom","onScroll","scrollEventThrottle","contentOffset","automaticallyAdjustContentInsets","onMomentumScrollEnd"],"sources":["ScrollView.tsx"],"sourcesContent":["import React from 'react'\nimport { ScrollViewProps, ScrollView as RNScrollView } from 'react-native'\nimport Animated from 'react-native-reanimated'\n\nimport {\n  useAfterMountEffect,\n  useChainCallback,\n  useCollapsibleStyle,\n  useScrollHandlerY,\n  useSharedAnimatedRef,\n  useTabNameContext,\n  useTabsContext,\n  useUpdateScrollViewContentSize,\n} from './hooks'\n\n/**\n * Used as a memo to prevent rerendering too often when the context changes.\n * See: https://github.com/facebook/react/issues/15156#issuecomment-474590693\n */\nconst ScrollViewMemo = React.memo(\n  React.forwardRef<RNScrollView, React.PropsWithChildren<ScrollViewProps>>(\n    (props, passRef) => {\n      return (\n        <Animated.ScrollView\n          // @ts-expect-error reanimated types are broken on ref\n          ref={passRef}\n          {...props}\n        />\n      )\n    }\n  )\n)\n\n/**\n * Use like a regular ScrollView.\n */\nexport const ScrollView = React.forwardRef<\n  RNScrollView,\n  React.PropsWithChildren<Omit<ScrollViewProps, 'onScroll'>>\n>(\n  (\n    {\n      contentContainerStyle,\n      style,\n      onContentSizeChange,\n      children,\n      refreshControl,\n      ...rest\n    },\n    passRef\n  ) => {\n    const name = useTabNameContext()\n    const ref = useSharedAnimatedRef<RNScrollView>(passRef)\n    const { setRef, contentInset } = useTabsContext()\n    const {\n      style: _style,\n      contentContainerStyle: _contentContainerStyle,\n      progressViewOffset,\n    } = useCollapsibleStyle()\n    const { scrollHandler, enable } = useScrollHandlerY(name)\n    const onLayout = useAfterMountEffect(rest.onLayout, () => {\n      'worklet'\n      // we enable the scroll event after mounting\n      // otherwise we get an `onScroll` call with the initial scroll position which can break things\n      enable(true)\n    })\n\n    React.useEffect(() => {\n      setRef(name, ref)\n    }, [name, ref, setRef])\n\n    const scrollContentSizeChange = useUpdateScrollViewContentSize({\n      name,\n    })\n\n    const scrollContentSizeChangeHandlers = useChainCallback(\n      React.useMemo(\n        () => [scrollContentSizeChange, onContentSizeChange],\n        [onContentSizeChange, scrollContentSizeChange]\n      )\n    )\n\n    const memoRefreshControl = React.useMemo(\n      () =>\n        refreshControl &&\n        React.cloneElement(refreshControl, {\n          progressViewOffset,\n          ...refreshControl.props,\n        }),\n      [progressViewOffset, refreshControl]\n    )\n\n    const memoContentInset = React.useMemo(\n      () => ({ top: contentInset }),\n      [contentInset]\n    )\n\n    const memoContentOffset = React.useMemo(\n      () => ({ x: 0, y: -contentInset }),\n      [contentInset]\n    )\n\n    const memoContentContainerStyle = React.useMemo(\n      () => [\n        _contentContainerStyle,\n        // TODO: investigate types\n        contentContainerStyle as any,\n      ],\n      [_contentContainerStyle, contentContainerStyle]\n    )\n    const memoStyle = React.useMemo(() => [_style, style], [_style, style])\n\n    return (\n      <ScrollViewMemo\n        {...rest}\n        onLayout={onLayout}\n        ref={ref}\n        bouncesZoom={false}\n        style={memoStyle}\n        contentContainerStyle={memoContentContainerStyle}\n        onScroll={scrollHandler}\n        onContentSizeChange={scrollContentSizeChangeHandlers}\n        scrollEventThrottle={16}\n        contentInset={memoContentInset}\n        contentOffset={memoContentOffset}\n        automaticallyAdjustContentInsets={false}\n        refreshControl={memoRefreshControl}\n        // workaround for: https://github.com/software-mansion/react-native-reanimated/issues/2735\n        onMomentumScrollEnd={() => {}}\n      >\n        {children}\n      </ScrollViewMemo>\n    )\n  }\n)\n"],"mappings":"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","ignoreList":[]}