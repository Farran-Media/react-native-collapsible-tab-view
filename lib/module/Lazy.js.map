{"version":3,"names":["React","useCallback","StyleSheet","Animated","useSharedValue","useAnimatedReaction","runOnJS","withTiming","useAnimatedStyle","ScrollView","useScroller","useTabNameContext","useTabsContext","Lazy","children","cancelLazyFadeIn","startMounted","_startMounted","mountDelayMs","name","focusedTab","refMap","didTriggerLayout","canMount","setCanMount","useState","isSelfMounted","useRef","shouldStartMounted","value","initialOpacity","opacity","useEffect","current","startMountTimer","setTimeout","focused","wasFocused","scrollTo","ref","isMounted","wasMounted","stylez","onLayout","createElement","View","pointerEvents","style","styles","container","undefined","create","flex"],"sources":["Lazy.tsx"],"sourcesContent":["import React, { useCallback } from 'react'\nimport { StyleSheet } from 'react-native'\nimport Animated, {\n  useSharedValue,\n  useAnimatedReaction,\n  runOnJS,\n  withTiming,\n  useAnimatedStyle,\n} from 'react-native-reanimated'\n\nimport { ScrollView } from './ScrollView'\nimport { useScroller, useTabNameContext, useTabsContext } from './hooks'\n\n/**\n * Typically used internally, but if you want to mix lazy and regular screens you can wrap the lazy ones with this component.\n */\nexport const Lazy: React.FC<{\n  /**\n   * Whether to cancel the lazy fade in animation. Defaults to false.\n   */\n  cancelLazyFadeIn?: boolean\n  /**\n   * How long to wait before mounting the children.\n   */\n  mountDelayMs?: number\n  /**\n   * Whether to start mounted. Defaults to true if we are the focused tab.\n   */\n  startMounted?: boolean\n  children: React.ReactElement\n}> = ({\n  children,\n  cancelLazyFadeIn,\n  startMounted: _startMounted,\n  mountDelayMs = 50,\n}) => {\n  const name = useTabNameContext()\n  const { focusedTab, refMap } = useTabsContext()\n\n  /**\n   * We keep track of whether a layout has been triggered\n   */\n  const didTriggerLayout = useSharedValue(false)\n\n  /**\n   * This is used to control when children are mounted\n   */\n  const [canMount, setCanMount] = React.useState(false)\n  /**\n   * Ensure we don't mount after the component has been unmounted\n   */\n  const isSelfMounted = React.useRef(true)\n\n  /**\n   * We start mounted if we are the focused tab, or if props.startMounted is true.\n   */\n  const shouldStartMounted =\n    typeof _startMounted === 'boolean'\n      ? _startMounted\n      : focusedTab.value === name\n  let initialOpacity = 1\n  if (!cancelLazyFadeIn && !shouldStartMounted) {\n    initialOpacity = 0\n  }\n  const opacity = useSharedValue(initialOpacity)\n\n  React.useEffect(() => {\n    return () => {\n      isSelfMounted.current = false\n    }\n  }, [])\n\n  const startMountTimer = React.useCallback(\n    (focusedTab: string) => {\n      // wait the scene to be at least mountDelay ms focused, before mounting\n      setTimeout(() => {\n        if (focusedTab === name) {\n          if (isSelfMounted.current) setCanMount(true)\n        }\n      }, mountDelayMs)\n    },\n    [mountDelayMs, name]\n  )\n\n  useAnimatedReaction(\n    () => {\n      return focusedTab.value === name\n    },\n    (focused, wasFocused) => {\n      if (focused && !wasFocused && !canMount) {\n        if (cancelLazyFadeIn) {\n          opacity.value = 1\n          runOnJS(setCanMount)(true)\n        } else {\n          runOnJS(startMountTimer)(focusedTab.value)\n        }\n      }\n    },\n    [canMount, focusedTab]\n  )\n\n  const scrollTo = useScroller()\n\n  const ref = name ? refMap[name] : null\n\n  useAnimatedReaction(\n    () => {\n      return didTriggerLayout.value\n    },\n    (isMounted, wasMounted) => {\n      if (isMounted && !wasMounted) {\n        if (!cancelLazyFadeIn && opacity.value !== 1) {\n          opacity.value = withTiming(1)\n        }\n      }\n    },\n    [ref, cancelLazyFadeIn, name, didTriggerLayout, scrollTo]\n  )\n\n  const stylez = useAnimatedStyle(() => {\n    return {\n      opacity: opacity.value,\n    }\n  }, [opacity])\n\n  const onLayout = useCallback(() => {\n    didTriggerLayout.value = true\n  }, [didTriggerLayout])\n\n  return canMount ? (\n    cancelLazyFadeIn ? (\n      children\n    ) : (\n      <Animated.View\n        pointerEvents=\"box-none\"\n        style={[styles.container, !cancelLazyFadeIn ? stylez : undefined]}\n        onLayout={onLayout}\n      >\n        {children}\n      </Animated.View>\n    )\n  ) : (\n    <ScrollView />\n  )\n}\n\nconst styles = StyleSheet.create({\n  container: {\n    flex: 1,\n  },\n})\n"],"mappings":"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","ignoreList":[]}