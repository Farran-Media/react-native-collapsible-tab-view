{"version":3,"names":["React","useCallback","Animated","useSharedValue","useAnimatedReaction","useChainCallback","useCollapsibleStyle","useScrollHandlerY","useSharedAnimatedRef","useTabNameContext","useTabsContext","useUpdateScrollViewContentSize","AnimatedFlashList","ensureFlastList","flashListModule","require","createAnimatedComponent","FlashList","console","error","FlashListMemo","memo","forwardRef","props","passRef","createElement","_extends","ref","Fragment","FlashListImpl","style","onContentSizeChange","refreshControl","contentContainerStyle","_contentContainerStyle","rest","name","setRef","contentInset","recyclerRef","scrollHandler","enable","hadLoad","onLoad","value","ready","progressViewOffset","useEffect","scrollContentSizeChange","scrollContentSizeChangeHandlers","useMemo","memoRefreshControl","cloneElement","memoContentInset","top","memoContentOffset","x","y","memoContentContainerStyle","paddingTop","refWorkaround","recyclerlistview_unsafe","bouncesZoom","onScroll","scrollEventThrottle","contentOffset","automaticallyAdjustContentInsets"],"sources":["FlashList.tsx"],"sourcesContent":["import type {\n  FlashListProps,\n  FlashList as SPFlashList,\n} from '@shopify/flash-list'\nimport React, { useCallback } from 'react'\nimport Animated, {\n  useSharedValue,\n  useAnimatedReaction,\n} from 'react-native-reanimated'\n\nimport {\n  useChainCallback,\n  useCollapsibleStyle,\n  useScrollHandlerY,\n  useSharedAnimatedRef,\n  useTabNameContext,\n  useTabsContext,\n  useUpdateScrollViewContentSize,\n} from './hooks'\n\n/**\n * Used as a memo to prevent rerendering too often when the context changes.\n * See: https://github.com/facebook/react/issues/15156#issuecomment-474590693\n */\n\ntype FlashListMemoProps = React.PropsWithChildren<FlashListProps<unknown>>\ntype FlashListMemoRef = SPFlashList<any>\n\nlet AnimatedFlashList: React.ComponentClass<FlashListProps<any>> | null = null\n\nconst ensureFlastList = () => {\n  if (AnimatedFlashList) {\n    return\n  }\n\n  try {\n    const flashListModule = require('@shopify/flash-list')\n    AnimatedFlashList = Animated.createAnimatedComponent(\n      flashListModule.FlashList\n    ) as unknown as React.ComponentClass<FlashListProps<any>>\n  } catch {\n    console.error(\n      'The optional dependency @shopify/flash-list is not installed. Please install it to use the FlashList component.'\n    )\n  }\n}\n\nconst FlashListMemo = React.memo(\n  React.forwardRef<FlashListMemoRef, FlashListMemoProps>((props, passRef) => {\n    ensureFlastList()\n    return AnimatedFlashList ? (\n      <AnimatedFlashList ref={passRef} {...props} />\n    ) : (\n      <></>\n    )\n  })\n)\n\nfunction FlashListImpl<R>(\n  {\n    style,\n    onContentSizeChange,\n    refreshControl,\n    contentContainerStyle: _contentContainerStyle,\n    ...rest\n  }: Omit<FlashListProps<R>, 'onScroll'>,\n  passRef: React.Ref<SPFlashList<any>>\n) {\n  const name = useTabNameContext()\n  const { setRef, contentInset } = useTabsContext()\n  const ref = useSharedAnimatedRef<any>(passRef)\n  const recyclerRef = useSharedAnimatedRef<any>(null)\n\n  const { scrollHandler, enable } = useScrollHandlerY(name)\n\n  const hadLoad = useSharedValue(false)\n\n  const onLoad = useCallback(() => {\n    hadLoad.value = true\n  }, [hadLoad])\n\n  useAnimatedReaction(\n    () => {\n      return hadLoad.value\n    },\n    (ready) => {\n      if (ready) {\n        enable(true)\n      }\n    }\n  )\n\n  const { progressViewOffset, contentContainerStyle } = useCollapsibleStyle()\n\n  React.useEffect(() => {\n    setRef(name, recyclerRef)\n  }, [name, recyclerRef, setRef])\n\n  const scrollContentSizeChange = useUpdateScrollViewContentSize({\n    name,\n  })\n\n  const scrollContentSizeChangeHandlers = useChainCallback(\n    React.useMemo(\n      () => [scrollContentSizeChange, onContentSizeChange],\n      [onContentSizeChange, scrollContentSizeChange]\n    )\n  )\n\n  const memoRefreshControl = React.useMemo(\n    () =>\n      refreshControl &&\n      React.cloneElement(refreshControl, {\n        progressViewOffset,\n        ...refreshControl.props,\n      }),\n    [progressViewOffset, refreshControl]\n  )\n\n  const memoContentInset = React.useMemo(\n    () => ({ top: contentInset }),\n    [contentInset]\n  )\n\n  const memoContentOffset = React.useMemo(\n    () => ({ x: 0, y: -contentInset }),\n    [contentInset]\n  )\n\n  const memoContentContainerStyle = React.useMemo(\n    () => ({\n      paddingTop: contentContainerStyle.paddingTop,\n      ..._contentContainerStyle,\n    }),\n    [_contentContainerStyle, contentContainerStyle.paddingTop]\n  )\n\n  const refWorkaround = useCallback(\n    (value: FlashListMemoRef | null): void => {\n      // https://github.com/Shopify/flash-list/blob/2d31530ed447a314ec5429754c7ce88dad8fd087/src/FlashList.tsx#L829\n      // We are not accessing the right element or view of the Flashlist (recyclerlistview). So we need to give\n      // this ref the access to it\n      // eslint-ignore\n      ;(recyclerRef as any)(value?.recyclerlistview_unsafe)\n      ;(ref as any)(value)\n    },\n    [recyclerRef, ref]\n  )\n\n  return (\n    // @ts-expect-error typescript complains about `unknown` in the memo, it should be T\n    <FlashListMemo\n      {...rest}\n      onLoad={onLoad}\n      ref={refWorkaround}\n      contentContainerStyle={memoContentContainerStyle}\n      bouncesZoom={false}\n      onScroll={scrollHandler}\n      scrollEventThrottle={16}\n      contentInset={memoContentInset}\n      contentOffset={memoContentOffset}\n      refreshControl={memoRefreshControl}\n      progressViewOffset={progressViewOffset}\n      automaticallyAdjustContentInsets={false}\n      onContentSizeChange={scrollContentSizeChangeHandlers}\n    />\n  )\n}\n\n/**\n * Use like a regular FlashList.\n */\nexport const FlashList = React.forwardRef(FlashListImpl) as <T>(\n  p: FlashListProps<T> & { ref?: React.Ref<SPFlashList<T>> }\n) => React.ReactElement\n"],"mappings":";AAIA,OAAOA,KAAK,IAAIC,WAAW,QAAQ,OAAO;AAC1C,OAAOC,QAAQ,IACbC,cAAc,EACdC,mBAAmB,QACd,yBAAyB;AAEhC,SACEC,gBAAgB,EAChBC,mBAAmB,EACnBC,iBAAiB,EACjBC,oBAAoB,EACpBC,iBAAiB,EACjBC,cAAc,EACdC,8BAA8B,QACzB,SAAS;;AAEhB;AACA;AACA;AACA;;AAKA,IAAIC,iBAAmE,GAAG,IAAI;AAE9E,MAAMC,eAAe,GAAGA,CAAA,KAAM;EAC5B,IAAID,iBAAiB,EAAE;IACrB;EACF;EAEA,IAAI;IACF,MAAME,eAAe,GAAGC,OAAO,CAAC,qBAAqB,CAAC;IACtDH,iBAAiB,GAAGV,QAAQ,CAACc,uBAAuB,CAClDF,eAAe,CAACG,SAClB,CAAyD;EAC3D,CAAC,CAAC,MAAM;IACNC,OAAO,CAACC,KAAK,CACX,iHACF,CAAC;EACH;AACF,CAAC;AAED,MAAMC,aAAa,gBAAGpB,KAAK,CAACqB,IAAI,cAC9BrB,KAAK,CAACsB,UAAU,CAAuC,CAACC,KAAK,EAAEC,OAAO,KAAK;EACzEX,eAAe,CAAC,CAAC;EACjB,OAAOD,iBAAiB,gBACtBZ,KAAA,CAAAyB,aAAA,CAACb,iBAAiB,EAAAc,QAAA;IAACC,GAAG,EAAEH;EAAQ,GAAKD,KAAK,CAAG,CAAC,gBAE9CvB,KAAA,CAAAyB,aAAA,CAAAzB,KAAA,CAAA4B,QAAA,MAAI,CACL;AACH,CAAC,CACH,CAAC;AAED,SAASC,aAAaA,CACpB;EACEC,KAAK;EACLC,mBAAmB;EACnBC,cAAc;EACdC,qBAAqB,EAAEC,sBAAsB;EAC7C,GAAGC;AACgC,CAAC,EACtCX,OAAoC,EACpC;EACA,MAAMY,IAAI,GAAG3B,iBAAiB,CAAC,CAAC;EAChC,MAAM;IAAE4B,MAAM;IAAEC;EAAa,CAAC,GAAG5B,cAAc,CAAC,CAAC;EACjD,MAAMiB,GAAG,GAAGnB,oBAAoB,CAAMgB,OAAO,CAAC;EAC9C,MAAMe,WAAW,GAAG/B,oBAAoB,CAAM,IAAI,CAAC;EAEnD,MAAM;IAAEgC,aAAa;IAAEC;EAAO,CAAC,GAAGlC,iBAAiB,CAAC6B,IAAI,CAAC;EAEzD,MAAMM,OAAO,GAAGvC,cAAc,CAAC,KAAK,CAAC;EAErC,MAAMwC,MAAM,GAAG1C,WAAW,CAAC,MAAM;IAC/ByC,OAAO,CAACE,KAAK,GAAG,IAAI;EACtB,CAAC,EAAE,CAACF,OAAO,CAAC,CAAC;EAEbtC,mBAAmB,CACjB,MAAM;IACJ,OAAOsC,OAAO,CAACE,KAAK;EACtB,CAAC,EACAC,KAAK,IAAK;IACT,IAAIA,KAAK,EAAE;MACTJ,MAAM,CAAC,IAAI,CAAC;IACd;EACF,CACF,CAAC;EAED,MAAM;IAAEK,kBAAkB;IAAEb;EAAsB,CAAC,GAAG3B,mBAAmB,CAAC,CAAC;EAE3EN,KAAK,CAAC+C,SAAS,CAAC,MAAM;IACpBV,MAAM,CAACD,IAAI,EAAEG,WAAW,CAAC;EAC3B,CAAC,EAAE,CAACH,IAAI,EAAEG,WAAW,EAAEF,MAAM,CAAC,CAAC;EAE/B,MAAMW,uBAAuB,GAAGrC,8BAA8B,CAAC;IAC7DyB;EACF,CAAC,CAAC;EAEF,MAAMa,+BAA+B,GAAG5C,gBAAgB,CACtDL,KAAK,CAACkD,OAAO,CACX,MAAM,CAACF,uBAAuB,EAAEjB,mBAAmB,CAAC,EACpD,CAACA,mBAAmB,EAAEiB,uBAAuB,CAC/C,CACF,CAAC;EAED,MAAMG,kBAAkB,GAAGnD,KAAK,CAACkD,OAAO,CACtC,MACElB,cAAc,iBACdhC,KAAK,CAACoD,YAAY,CAACpB,cAAc,EAAE;IACjCc,kBAAkB;IAClB,GAAGd,cAAc,CAACT;EACpB,CAAC,CAAC,EACJ,CAACuB,kBAAkB,EAAEd,cAAc,CACrC,CAAC;EAED,MAAMqB,gBAAgB,GAAGrD,KAAK,CAACkD,OAAO,CACpC,OAAO;IAAEI,GAAG,EAAEhB;EAAa,CAAC,CAAC,EAC7B,CAACA,YAAY,CACf,CAAC;EAED,MAAMiB,iBAAiB,GAAGvD,KAAK,CAACkD,OAAO,CACrC,OAAO;IAAEM,CAAC,EAAE,CAAC;IAAEC,CAAC,EAAE,CAACnB;EAAa,CAAC,CAAC,EAClC,CAACA,YAAY,CACf,CAAC;EAED,MAAMoB,yBAAyB,GAAG1D,KAAK,CAACkD,OAAO,CAC7C,OAAO;IACLS,UAAU,EAAE1B,qBAAqB,CAAC0B,UAAU;IAC5C,GAAGzB;EACL,CAAC,CAAC,EACF,CAACA,sBAAsB,EAAED,qBAAqB,CAAC0B,UAAU,CAC3D,CAAC;EAED,MAAMC,aAAa,GAAG3D,WAAW,CAC9B2C,KAA8B,IAAW;IACxC;IACA;IACA;IACA;IACA;IAAEL,WAAW,CAASK,KAAK,aAALA,KAAK,uBAALA,KAAK,CAAEiB,uBAAuB,CAAC;IACnDlC,GAAG,CAASiB,KAAK,CAAC;EACtB,CAAC,EACD,CAACL,WAAW,EAAEZ,GAAG,CACnB,CAAC;EAED;IAAA;IACE;IACA3B,KAAA,CAAAyB,aAAA,CAACL,aAAa,EAAAM,QAAA,KACRS,IAAI;MACRQ,MAAM,EAAEA,MAAO;MACfhB,GAAG,EAAEiC,aAAc;MACnB3B,qBAAqB,EAAEyB,yBAA0B;MACjDI,WAAW,EAAE,KAAM;MACnBC,QAAQ,EAAEvB,aAAc;MACxBwB,mBAAmB,EAAE,EAAG;MACxB1B,YAAY,EAAEe,gBAAiB;MAC/BY,aAAa,EAAEV,iBAAkB;MACjCvB,cAAc,EAAEmB,kBAAmB;MACnCL,kBAAkB,EAAEA,kBAAmB;MACvCoB,gCAAgC,EAAE,KAAM;MACxCnC,mBAAmB,EAAEkB;IAAgC,EACtD;EAAC;AAEN;;AAEA;AACA;AACA;AACA,OAAO,MAAMhC,SAAS,gBAAGjB,KAAK,CAACsB,UAAU,CAACO,aAAa,CAEhC","ignoreList":[]}